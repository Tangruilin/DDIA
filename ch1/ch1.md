
# 可靠，可拓展并且可维护的应用
> <i>The Internet was done so well that most people think of it as a natural resource like the Pacific Ocean, rather than somthing that was man-made. When was the last time a technology with a scale like that was so error-free
></i>

> ——Alan Kay

如今的大多数应用都是数据密集型而不是计算密集型了。对于这些应用而言，CPU功率很少再能成为他们的限制因素——数据量、数据的复杂度与数据流变化的速率往往是更大的问题。
一个数据密集型应用通常是基于提供通用需求的标准模块构建的。例如，大量的应用系统需要以下模块：
- 数据库：存储数据，以供他们（数据库）或者其他应用可以再次访问；
- 缓存：记录消耗比较大的操作的结果，以加速下一次的访问；
- 索引：允许用户通过关键字搜索数据或是使用各种方式过滤数据；
- 流式处理：采用异步方式向另一个进程发送消息；
- 批处理：定期处理大量积累的数据；

这些或许看上去很稀松平常，这只是因为这些数据系统是相当成功的一个抽象：我们无时无刻不在使用他们，而不用做太多的思考。
当需要构建一个应用的时候，大多数工程师不会想着从头开始写一个新的存储引擎，因为数据库就是完成这项工作的一个很好的工具。

但是可靠并没有那么简单。有大量的数据系统扮演者不同的角色，因为不同的应用有着不同的需求。
这世上有着多种构建缓存的方案，多种构建搜索索引的方案，其他类型的数据系统也有多种构建方案。
当构建一个应用的时候，我们仍然要弄清楚那些工具、哪些方法是最适合手头上的任务的。
并且当在单个工具完成不了的任务时，将各个工具联合使用时很困难的一件事情。

本书是一场既包含数据系统理论，也包含数据系统实践的旅行，同时还告诉了你如何使用二者去构建一个数据密集型应用。
我们将探索各种工具之间有何相同、有何不同、以及他们是如何实现他们的特性的。

在这一章，我们将从我们想要实现的基础开始：可靠、可拓展、可维护的数据系统。
我们将说明这意味着什么，简单介绍一些思考他们的方法，并且概览一下我们在之后章节会需要的内容。
在接下来的章节，我们会层层递进，看一下工作在数据密集型应用上时需要被考虑到的一些设计方案。

## 认识数据系统
我们通常会将数据库、队列、高数缓存等看作完全不同类别的工具。
尽管一个数据库和一个消息队列是有一些高度相似的——有时候都会存储一些数据——但是他们有着非常不同的访问模式，这意味着不同的工作特性，并且因此有非常不同的实现。

所以，为什么我们要将他们归为一类，称之为<i>数据系统</i>呢?

这些年浮现出非常多新的数据库和应用。他们为大量不同的应用场景进行了优化，并且他们不再适合被归类于传统类别。
比如，有一些数据库同样被作为消息队列使用（redis），并且也有带有类似于数据库的持久化存储保证功能的消息队列（Apache Kafka）。
这些类别之间的边界正在变得越来越模糊。

其次，如今越来越多的应用有了单个组件无法满足所有数据处理和存储需求的广泛要求。
因此，工作被分解为可以在单一组件上高效完成的各项任务，并且这些组件会通过应用层代码衔接起来。

举个例子，如果你有一个应用——包含缓存层（使用memcached或者其他工具），或者一个与主数据库独立出来的全文检索服务（例如Elasticsearch或者Solr），通常保持保证缓存层与索引和主数据库的关联是应用层代码的职责。
图1-1给出了这个过程的一个概览（我们会在后续章节涉及更多细节）：
<div align="center"><img src="https://raw.githubusercontent.com/Tangruilin/GithubImages/main/img/20211020142743.png" alt = "Figure1-1"/></div>
<center>图1-1包含数个组件的数据系统可能架构</center>
当你结合多个组件来提供服务的时候，服务接口或者说API通常会为客户隐藏这些实现细节。
这样我们就基于更小的，相对通用的组件从根本上构建了一个新的，更有针对性的数据系统。
你混合构造的数据系统应该提供一下几个具体的保证：缓存应该在写入的时候正确地刷新以让外部用户可以看到一致性的结果。
你现在不仅仅是一个应用构建者，同时也是一个数据系统构建者了。

如果你在设计一个数据系统或者服务，一大堆棘手的问题会冒出来。
即使是在系统发生局部性错误的时候，你应该如何保证数据的正确性和完整性？
即使是在系统的部分发生降级的时候，你如何向客户保证一致性？
当负载提高的时候你应该如何拓展？
一个好的服务API是什么样的？

有很多可以影响一个数据系统的设计的因素，包含了从业人员的技巧和经验，遗留的系统依赖，交付周期，你的团队对不同的错误的容忍程度，监管规范等。这些因素与环境的关系非常大。

在这本书中，我们会聚焦于对大多数软件系统最重要的三个点：
- 可靠性

    即使是在遇到故障（硬件错误或者软件错误，甚至是人为错误）时，系统都应该正确地工作（在所期待的水平表现出正确的行为）。

- 可拓展性

    在系统需要拓展时（数据层面，流量层面，或者复杂度），处理这些拓展的方式是要有依据的。

- 可维护性

    随着时间的推移，会有很多不同的人在这个系统上工作（工程师或者操作人员，都会维护一些当前的工作或者为新的情景去改造系统），他们应该能在系统上有所产出。

这些词汇经常被翻来覆去地思考，但是很多人对他们没有一个好的理解。
为了那些乐于思考的工程师们的利益，我们将会用这个章节剩下的部分思考可靠性，可拓展性，可维护性。接下来，在剩下的章节，我们会看各种各样被用来实现这些目标的技术、架构、以及算法。

## 可靠性
